import React, { useEffect, useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { motion } from "framer-motion";
import { initializeApp } from "firebase/app";
import {
  getFirestore,
  doc,
  getDoc,
  updateDoc,
  onSnapshot,
} from "firebase/firestore";
import Image from "next/image";

const firebaseConfig = {
  apiKey: "AIzaSyBD8otWcBJkodFDPG4CfV_Os5dgqIpvuZo",
  authDomain: "nfc-estoque.firebaseapp.com",
  projectId: "nfc-estoque",
  storageBucket: "nfc-estoque.appspot.com",
  messagingSenderId: "1033393838098",
  appId: "1:1033393838098:web:a2c9cbfc5998c1214520cb",
  measurementId: "G-XNV8PH1T9L",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const produtosInfo = [
  {
    id: "fibra",
    nome: "Cabo de Fibra Óptica",
    icone: "https://cdn-icons-png.flaticon.com/512/649/649797.png",
  },
  {
    id: "roteador",
    nome: "Roteador Wi-Fi",
    icone:
      "https://th.bing.com/th/id/R.a737fac85e09e2710a60c6d7d292e048?rik=bB89%2bLdNcsVFIw&pid=ImgRaw&r=0",
  },
  {
    id: "conector",
    nome: "Conector Óptico",
    icone: "https://cdn-icons-png.flaticon.com/512/4548/4548927.png",
  },
  {
    id: "switch",
    nome: "Switch Ethernet",
    icone: "https://cdn-icons-png.flaticon.com/512/5344/5344212.png",
  },
];

export default function EstoquePage() {
  const [estoque, setEstoque] = useState({});

  useEffect(() => {
    const unsub = onSnapshot(doc(db, "estoque", "produtos"), (doc) => {
      setEstoque(doc.data());
    });
    return () => unsub();
  }, []);

  useEffect(() => {
    const urlParams = new URLSearchParams(window.location.search);
    const acao = urlParams.get("acao");
    if (acao && estoque[acao] > 0) {
      const produtoRef = doc(db, "estoque", "produtos");
      updateDoc(produtoRef, {
        [acao]: estoque[acao] - 1,
      });
    }
  }, [estoque]);

  return (
    <div className="min-h-screen bg-blue-950 text-white p-6">
      <div className="flex items-center mb-8">
        <Image
          src="https://th.bing.com/th/id/OIP.FvtIQ-JIZsoHXCvzG1rj9QHaHa?rs=1&pid=ImgDetMain"
          alt="Logo"
          width={80}
          height={80}
          className="rounded-full mr-4"
        />
        <h1 className="text-3xl font-bold text-yellow-400">
          Estoque Inteligente com NFC
        </h1>
      </div>
      <div className="space-y-6">
        {produtosInfo.map((produto) => (
          <Card key={produto.id} className="bg-white text-black">
            <CardContent className="flex items-center justify-between p-4">
              <div className="flex items-center gap-4">
                <Image
                  src={produto.icone}
                  alt={produto.nome}
                  width={40}
                  height={40}
                />
                <div>
                  <p className="font-semibold">{produto.nome}</p>
                  <p className="text-sm text-gray-600">
                    Quantidade: {estoque[produto.id] ?? 0}
                  </p>
                </div>
              </div>
              {estoque[produto.id] === 0 && (
                <p className="text-red-600 font-semibold">Estoque Zerado</p>
              )}
            </CardContent>
          </Card>
        ))}
      </div>
      <div className="mt-8">
        <h2 className="text-lg font-semibold mb-2 text-yellow-300">
          Simuladores de Cartão NFC:
        </h2>
        <ul className="space-y-2">
          <li>
            <a
              href="?acao=remover-fibra"
              className="text-yellow-300 underline"
            >
              NFC - Cabo de Fibra Óptica
            </a>
          </li>
          <li>
            <a
              href="?acao=remover-roteador"
              className="text-yellow-300 underline"
            >
              NFC - Roteador Wi-Fi
            </a>
          </li>
          <li>
            <a
              href="?acao=remover-conector"
              className="text-yellow-300 underline"
            >
              NFC - Conector Óptico
            </a>
          </li>
          <li>
            <a
              href="?acao=remover-switch"
              className="text-yellow-300 underline"
            >
              NFC - Switch Ethernet
            </a>
          </li>
        </ul>
      </div>
    </div>
  );
}
